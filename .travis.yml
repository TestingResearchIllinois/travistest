language: java

before_install:
    - echo "BEFORE INSTALL"
    - touch NOW
    - find $HOME/CACHE -name "*.class" | while read line; do du -sh $line; d=$(dirname ${line}); DIR=$(dirname ${line#$HOME/CACHE}); if [[ -d ${DIR#${d}} ]]; then cp -r $line $DIR; fi; done
    - find -newer NOW

before_script:
    - echo "BEFORE SCRIPT"

install:
    - echo "INSTALL"
    - touch NOW
    - gradle assemble
    - find -newer NOW

script:
    - echo "SCRIPT"
    - touch NOW
    - gradle check
    - find -newer NOW

after_success:
    - echo "SUCCESS"

before_cache:
    - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
    - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
    - find $TRAVIS_BUILD_DIR -name "*.class" | while read line; do du -sh $line; DIR=$(dirname $HOME/CACHE$line); mkdir -p $DIR; cp -r $line $DIR; done

cache:
    directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
        - $HOME/CACHE
